<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Paciente | Perfil</title>

<style>
:root{
  --verde:#1e8f5a;
  --verde-soft:#e9f8f0;
  --borde:#cceedd;
  --bg:#f4fbf7;
}

*{
  margin:0;
  padding:0;
  box-sizing:border-box;
  font-family:"Segoe UI",sans-serif;
}

body{
  min-height:100vh;
  display:flex;
  background:var(--bg);
}

/* SIDEBAR */
.sidebar{
  width:260px;
  background:#fff;
  border-right:1px solid var(--borde);
  padding:2rem 1.5rem;
}

.logo{
  display:block;
  margin:0 auto 2rem;
  max-width:90px;
}

.sidebar a{
  display:block;
  padding:0.9rem 1rem;
  border-radius:12px;
  color:var(--verde);
  text-decoration:none;
  font-weight:600;
  margin-bottom:0.6rem;
}

.sidebar a.active,
.sidebar a:hover{
  background:var(--verde-soft);
}

/* CONTENT */
.content{
  flex:1;
  padding:3rem;
}

h1{
  text-align:center;
  font-weight:300;
  letter-spacing:4px;
  text-transform:uppercase;
  color:var(--verde);
  margin:1rem 0 2.5rem;
}

/* AVATAR */
.avatar-box{
  display:flex;
  justify-content:center;
  margin-bottom:2rem;
}

.avatar{
  width:130px;
  height:130px;
  border-radius:50%;
  object-fit:cover;
  border:4px solid var(--verde-soft);
}

/* CARD */
.card{
  background:#fff;
  border-radius:22px;
  padding:2.5rem;
  box-shadow:0 15px 35px rgba(0,0,0,0.08);
  max-width:600px;
  margin:auto;
}

.field{
  margin-bottom:1.4rem;
}

.label{
  font-size:0.75rem;
  text-transform:uppercase;
  letter-spacing:1px;
  color:#666;
}

.value{
  margin-top:0.4rem;
  font-size:1rem;
  font-weight:600;
  color:#222;
}

/* FORM */
input,select{
  width:100%;
  margin-top:0.4rem;
  padding:0.7rem;
  border-radius:10px;
  border:1px solid var(--borde);
}

.btn-save{
  margin-top:1.5rem;
  padding:0.9rem;
  width:100%;
  border:none;
  border-radius:14px;
  background:var(--verde);
  color:#fff;
  font-weight:700;
  cursor:pointer;
}
</style>
</head>

<body>

<div class="sidebar">
  <img src="logomed.png" class="logo">

  <a href="/paciente.html" class="nav-link">Inicio</a>
  <a href="/perfil.html" class="nav-link active">Mi perfil</a>
  <a href="/mis-recetas.html" class="nav-link">Mis recetas</a>
  <a href="/historial.html" class="nav-link">Historial</a>
  <a href="/logout" class="nav-link logout">Cerrar sesión</a>
</div>


<div class="content">

  <div class="avatar-box">
  <img class="avatar" src="/usuario.png">
  </div>

  <h1>Mi perfil</h1>
  <div class="card">

    <!-- VISTA -->
    <div class="field">
      <div class="label">Nombre</div>
      <div class="value" id="nombre">—</div>
    </div>

    <div class="field">
      <div class="label">Correo</div>
      <div class="value" id="email">—</div>
    </div>

    <div class="field">
      <div class="label">Teléfono</div>
      <div class="value" id="verTelefono">—</div>
    </div>

    <div class="field">
      <div class="label">Fecha de nacimiento</div>
      <div class="value" id="verNacimiento">—</div>
    </div>

    <div class="field">
      <div class="label">Sexo</div>
      <div class="value" id="verSexo">—</div>
    </div>

    <div class="field">
      <div class="label">Miembro desde</div>
      <div class="value" id="registro">—</div>
    </div>

    <hr style="margin:2rem 0; border:none; border-top:1px solid var(--borde);">

    <!-- EDITAR -->
    <form id="formPerfil">

      <div class="field">
        <div class="label">Teléfono</div>
        <input id="editTelefono">
      </div>

      <div class="field">
        <div class="label">Fecha de nacimiento</div>
        <input type="date" id="editFecha">
      </div>

      <div class="field">
        <div class="label">Sexo</div>
        <select id="editSexo">
          <option value="">Seleccionar</option>
          <option value="Masculino">Masculino</option>
          <option value="Femenino">Femenino</option>
        </select>
      </div>

      <button class="btn-save">Guardar cambios</button>
    </form>

  </div>
</div>

<script>
fetch('/paciente/perfil')
  .then(r => r.json())
  .then(p => {

    // Vista
    nombre.textContent = p.nombre;
    email.textContent = p.email;
    verTelefono.textContent = p.telefono || 'No registrado';
    verNacimiento.textContent = p.fecha_nacimiento
      ? new Date(p.fecha_nacimiento).toLocaleDateString()
      : 'No registrado';
    verSexo.textContent = p.sexo || 'No especificado';
    registro.textContent = new Date(p.creado_en).toLocaleDateString();

    // Form
    editTelefono.value = p.telefono || '';
    editFecha.value = p.fecha_nacimiento
      ? p.fecha_nacimiento.split('T')[0]
      : '';
    editSexo.value = p.sexo || '';
  });

formPerfil.onsubmit = e =>{
  e.preventDefault();

  fetch('/paciente/perfil',{
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({
      telefono: editTelefono.value,
      fecha_nacimiento: editFecha.value,
      sexo: editSexo.value
    })
  }).then(()=>{
    alert('Perfil actualizado correctamente');
    location.reload();
  });
};
</script>

</body>
</html>
